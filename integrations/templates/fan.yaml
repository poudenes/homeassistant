#  ███████╗ █████╗ ███╗   ██╗
#  ██╔════╝██╔══██╗████╗  ██║
#  █████╗  ███████║██╔██╗ ██║
#  ██╔══╝  ██╔══██║██║╚██╗██║
#  ██║     ██║  ██║██║ ╚████║
#  ╚═╝     ╚═╝  ╚═╝╚═╝  ╚═══╝
###########################################################################################
---
###########################################################################################
# https://www.home-assistant.io/integrations/fan.template/
###########################################################################################
#- fan:
##    mechanical_ventilation:
#      friendly_name: "mechanical_ventilation"
#      value_template: >
#        {{ "off" if states('sensor.fan_speed') == 'Low' else "on" }}
#      percentage_template: >
#        {% set speedperc = {'Low': 0, 'Medium': 50, 'High': 100} %}
#        {{ speedperc[states('sensor.fan_speed')] }}
#      turn_on:
#        service: switch.turn_on
#        data:
#          entity_id: switch.fan_high
#      turn_off:
#        service: switch.turn_on
#        data:
#          entity_id: switch.fan_low
#      set_percentage:
#        service: switch.turn_on
##        data:
#          entity_id: >
#            {% set id_mapp = {0:'switch.fan_low', 50:'switch.fan_medium', 100:'switch.fan_high'} %}
#            {{ id_mapp[percentage] }}
#      speed_count: 2

- fan:
    - name: "mechanical_ventilation"
      state: >
        {{ "off" if states('sensor.fan_speed') == 'off' else "on" }}
      percentage: >
        {% set speed = {'off': 0, 'low': 33, 'medium': 66, 'high': 100} %}
        {{ speed.get(states('sensor.fan_speed'), 0) }}
      turn_on:
        action: switch.turn_on
        data:
          entity_id: switch.fan_high
      turn_off:
        action: switch.turn_on
        data:
          entity_id: switch.fan_standby
      set_percentage:
        action: switch.turn_on
        data_template:
          entity_id: >
            {% set id_mapp = {0: 'switch.fan_standby', 33:'switch.fan_low', 66:'switch.fan_medium', 100:'switch.fan_high'} %}
            {{id_mapp[percentage]}}
      speed_count: 2