#  ███████╗ █████╗ ███╗   ██╗
#  ██╔════╝██╔══██╗████╗  ██║
#  █████╗  ███████║██╔██╗ ██║
#  ██╔══╝  ██╔══██║██║╚██╗██║
#  ██║     ██║  ██║██║ ╚████║
#  ╚═╝     ╚═╝  ╚═╝╚═╝  ╚═══╝
###########################################################################################
---
###########################################################################################
# https://www.home-assistant.io/integrations/fan.template/
###########################################################################################
- fan:
    - name: "mechanical_ventilation"
      state: >
        {{ "off" if states('sensor.fan_speed') == 'off' else "on" }}
      percentage: >
        {% set speed = {'off': 0, 'low': 33, 'medium': 66, 'high': 100} %}
        {{ speed.get(states('sensor.fan_speed'), 0) }}
      turn_on:
        action: button.press # switch.turn_on
        data:
          entity_id: button.fan_high # switch.fan_high
      turn_off:
        action: button.press # switch.turn_on
        data:
          entity_id: button.fan_low # switch.fan_standby
      set_percentage:
        action: button.press # switch.turn_on
        data_template:
          entity_id: >
            {% set id_mapp = {0:'button.fan_low', 50:'button.fan_medium', 100:'button.fan_high'} %}
            {{id_mapp[percentage]}}
      speed_count: 2
      
      
# Test if this fan works better
    - name: "Fan test"
      unique_id: fan_test
      state: >
        {{ "off" if is_state('sensor.fan_speed', 'Low') else "on" }}
      preset_mode: >
        {{ states('sensor.fan_speed') | lower }}
      preset_modes:
        - "low"
        - "medium"
        - "high"
      turn_on:
        service: button.press
        target:
          entity_id: button.fan_high
      turn_off:
        service: button.press
        target:
          entity_id: button.fan_low
      set_preset_mode:
        service: button.press
        target:
          entity_id: >
            {% if preset_mode == "low" %}
              button.fan_low
            {% elif preset_mode == "medium" %}
              button.fan_medium
            {% else %}
              button.fan_high
            {% endif %}